---
title: "Final Project - Indicators of Anxiety or Depression Based on Reported Frequency of Symptoms During Last 7 Days"
date: last-modified
author: "Ian Walsh & Logan Rosell"
format: 
    html:
        embed-resources: true
jupyter: python3
---
**Reseach Question:** How did anxiety and depression levels differ between states following the outbreak of COVID-19 in the United States?

# Data Cleaning

Import libraries and dataset
```{python}
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import plotly.express as px
import warnings
from scipy.stats import pearsonr
from sklearn.linear_model import LinearRegression
from sklearn.metrics import PredictionErrorDisplay
from scipy.stats import probplot
from statsmodels.stats.outliers_influence import variance_inflation_factor

warnings.simplefilter(action='ignore', category=pd.errors.SettingWithCopyWarning)

df = pd.read_csv("./Datasets/Indicators_of_Anxiety_or_Depression_Based_on_Reported_Frequency_of_Symptoms_During_Last_7_Days.csv")

df.head()
```

Rename the "Value" column to "Percent" to more accurately portray what the data is measuring
```{python}
df.rename(columns={"Value": "Percent of Population"}, inplace = True)
```

Filter to only state data and drop unnecessary columns;Group and Subgroup are redundant, Time period and CI are just combinations of other column's data.
```{python}
state_data = df[df['Group']=='By State']

state_data.drop(columns = ['Group', 'Subgroup', 'Time Period Label', 'Confidence Interval'], inplace = True)
```

Seperate Quartile Range into 2 Columns:
```{python}
state_data[['Quartile_Lower', 'Quartile_Upper']] = state_data['Quartile Range'].str.split(' - ', expand=True)
state_data.drop(columns='Quartile Range')
```

Clean up the Phase column:
```{python}
state_data['Phase'].unique()
# There are 2 values that contain dates which are already stored in other columns, so we can remove these dates

state_data['Phase'] = state_data['Phase'].str.split(' ', expand = True).get(0)
```

Change Data Types as needed
```{python}
state_data['Indicator'] = pd.Categorical(state_data['Indicator'], categories = ['Symptoms of Depressive Disorder', 'Symptoms of Anxiety Disorder', 'Symptoms of Anxiety Disorder or Depressive Disorder'])

state_data['Phase'] = pd.Categorical(state_data['Phase'], categories=['1', '2', '3', '3.1', '3.2', '3.3', '3.4', '3.5', '3.6', '3.7', '3.8', '3.9', '3.10'])

state_data['Time Period Start Date'] = pd.to_datetime(state_data['Time Period Start Date']).dt.date
state_data['Time Period End Date'] = pd.to_datetime(state_data['Time Period End Date']).dt.date
```

# EDA 

Looking at some graphs
```{python}
# Histogram of values for all states
plt1 = sns.histplot(state_data, x='Percent of Population', hue = 'Indicator', alpha = 0.5)
plt.title('Histogram of Percent of Population by Indicator')
plt.show()
```

```{python}
# Pair Plot
pair_plot = sns.pairplot(state_data, hue = 'Indicator')
plt.show()
```

```{python}
national_avgs = state_data.groupby(['Time Period Start Date', 'Indicator'], observed=False).agg(
    nat_means = ('Percent of Population', 'mean')
)
nat_avg_plt = sns.lineplot(national_avgs,
                            x='Time Period Start Date',
                            y='nat_means',
                            hue = 'Indicator')
plt.xticks(rotation=45)
plt.title(f"Percent of Population Over Time")
plt.ylabel('Percent of Population')
plt.show()

```

```{python}
state_code_map = {
    "Alabama": "AL",
    "Alaska": "AK",
    "Arizona": "AZ",
    "Arkansas": "AR",
    "California": "CA",
    "Colorado": "CO",
    "Connecticut": "CT",
    "Delaware": "DE",
    "Florida": "FL",
    "Georgia": "GA",
    "Hawaii": "HI",
    "Idaho": "ID",
    "Illinois": "IL",
    "Indiana": "IN",
    "Iowa": "IA",
    "Kansas": "KS",
    "Kentucky": "KY",
    "Louisiana": "LA",
    "Maine": "ME",
    "Maryland": "MD",
    "Massachusetts": "MA",
    "Michigan": "MI",
    "Minnesota": "MN",
    "Mississippi": "MS",
    "Missouri": "MO",
    "Montana": "MT",
    "Nebraska": "NE",
    "Nevada": "NV",
    "New Hampshire": "NH",
    "New Jersey": "NJ",
    "New Mexico": "NM",
    "New York": "NY",
    "North Carolina": "NC",
    "North Dakota": "ND",
    "Ohio": "OH",
    "Oklahoma": "OK",
    "Oregon": "OR",
    "Pennsylvania": "PA",
    "Rhode Island": "RI",
    "South Carolina": "SC",
    "South Dakota": "SD",
    "Tennessee": "TN",
    "Texas": "TX",
    "Utah": "UT",
    "Vermont": "VT",
    "Virginia": "VA",
    "Washington": "WA",
    "West Virginia": "WV",
    "Wisconsin": "WI",
    "Wyoming": "WY",
    "District of Columbia": "DC",
    "American Samoa": "AS",
    "Guam": "GU",
    "Northern Mariana Islands": "MP",
    "Puerto Rico": "PR",
    "United States Minor Outlying Islands": "UM",
    "Virgin Islands, U.S.": "VI",
}

indicators = state_data['Indicator'].unique()
color_scales = ['blues','amp','purp']

for i,j in zip(indicators,color_scales):
    fig_data = state_data[(state_data['Indicator'] == i)]

    fig_data['State_Code'] = fig_data['State'].map(state_code_map)

    max = fig_data['Percent of Population'].max()
    min = fig_data['Percent of Population'].min()

    fig = px.choropleth(
        fig_data,
        locations='State_Code',
        locationmode='USA-states',
        color='Percent of Population',
        scope='usa',
        title=f'Map of {i} in US states',
        hover_name='State',
        color_continuous_scale=j,
        animation_frame='Time Period Start Date',
        range_color=[min,max]
    )
    fig.show()
```


# Linear Modeling


```{python}
def give_me_one_period(df, time_period):
    trimmed_df = df[df['Time Period'] == time_period]
    return trimmed_df
```

```{python}
def model_eval(df, x_col, y_col):
    x_reshaped = df[x_col].values.reshape(-1,1)
    model = LinearRegression().fit(x_reshaped, df[y_col])

    print('model intercept :', model.intercept_.round(3))
    print('model coefficients : ', model.coef_.round(3))
    print('R-Squared: ', model.score(x_reshaped, df[y_col]))
   
```

```{python}
def give_me_vif(df, x1, x2):
    only_vars = df.loc[:,[x1, x2]]
    print(f"VIF: {variance_inflation_factor(only_vars, exog_idx=1)}")
```

Modeling the percentage of the population with symptoms of anxiety as a function of the percentage of the population with symptoms of depression from time period one
```{python}
period_one = give_me_one_period(state_data, 1)

depression_reshaped = period_one['Perc of Pop with Symptoms of Depression'].values.reshape(-1,1)
anxiety_data = period_one['Perc of Pop with Symptoms of Anxiety']

anxiety_v_depression_model = LinearRegression().fit(depression_reshaped, anxiety_data)

model_eval(period_one, 'Perc of Pop with Symptoms of Depression', 'Perc of Pop with Symptoms of Anxiety')
```

Plotting the anxiety-depression relationship
```{python}
anxiety_v_depression_plt = sns.lmplot(period_one, x='Perc of Pop with Symptoms of Depression', y='Perc of Pop with Symptoms of Anxiety')
plt.show()

predErrDisp_model1 = PredictionErrorDisplay(y_true=period_one['Perc of Pop with Symptoms of Anxiety'], y_pred=anxiety_v_depression_model.predict(depression_reshaped))
predErrDisp_model1.plot()
plt.show()
```